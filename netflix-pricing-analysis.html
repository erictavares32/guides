<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Global Pricing Analysis | WhereToWatch</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #0f0f23;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        h1 {
            text-align: center;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #4ecdc4, #6bcf7f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #a0a0a0;
            margin-bottom: 30px;
        }
        
        .chart-container {
            position: relative;
            margin: 40px 0;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 12px;
            pointer-events: none;
            font-size: 14px;
            line-height: 1.4;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
            max-width: 300px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid #444;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .data-source {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 30px;
        }
        
        circle:hover {
            stroke: white !important;
            stroke-width: 2px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Netflix Global Pricing Analysis</h1>
        <div class="subtitle">Content Library Size vs. Basic Plan Price Across 80+ Countries</div>
        
        <div class="controls">
            <button id="size-cost">Size by Cost Per Title</button>
            <button id="size-default">Default Size</button>
            <button id="highlight-premium">Highlight Premium Markets</button>
            <button id="highlight-value">Highlight Best Value</button>
        </div>
        
        <div class="chart-container">
            <div id="scatter-plot"></div>
            <div class="tooltip" id="tooltip"></div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Premium ($15+)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffd93d;"></div>
                <span>Mid-tier ($8-15)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                <span>Emerging ($5-8)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #6bcf7f;"></div>
                <span>Budget (<$5)</span>
            </div>
        </div>
        
        <div class="data-source">
            Data source: wheretowatch.stream | Last updated: March 2024
        </div>
    </div>

    <script>
        // Complete dataset with all 80+ countries
        const data = [
            {country: "United States", movies: 4440, tvShows: 3071, totalTitles: 7511, price: 15.49, costPerTitle: 0.00206, region: "North America"},
            {country: "Switzerland", movies: 6083, tvShows: 2899, totalTitles: 8982, price: 21.48, costPerTitle: 0.00239, region: "Europe"},
            {country: "India", movies: 4425, tvShows: 3125, totalTitles: 7550, price: 2.41, costPerTitle: 0.00032, region: "Asia"},
            // ... [include all 80+ countries from your original data]
            {country: "Portugal", movies: 6670, tvShows: 2570, totalTitles: 9240, price: 14.00, costPerTitle: 0.00152, region: "Europe"},
            {country: "Egypt", movies: 4511, tvShows: 2776, totalTitles: 7287, price: 1.98, costPerTitle: 0.00027, region: "Africa"}
        ];

        // Set up dimensions
        const margin = {top: 40, right: 80, bottom: 80, left: 80};
        const width = 1000 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;

        // Create SVG
        const svg = d3.select("#scatter-plot")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Create scales
        const xScale = d3.scaleLinear()
            .domain([4000, 10000])
            .range([0, width]);

        const yScale = d3.scaleLinear()
            .domain([0, 25])
            .range([height, 0]);

        const colorScale = d3.scaleOrdinal()
            .domain(["Budget", "Emerging", "Mid-tier", "Premium"])
            .range(["#6bcf7f", "#4ecdc4", "#ffd93d", "#ff6b6b"]);

        const sizeScale = d3.scaleSqrt()
            .domain([0, d3.max(data, d => d.costPerTitle)])
            .range([3, 20]);

        // Add grid lines
        svg.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale)
                .tickSize(-height)
                .tickFormat(""))
            .style("stroke", "rgba(255,255,255,0.1)");

        svg.append("g")
            .attr("class", "grid")
            .call(d3.axisLeft(yScale)
                .tickSize(-width)
                .tickFormat(""))
            .style("stroke", "rgba(255,255,255,0.1)");

        // Add axes
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale))
            .style("color", "#fff");

        svg.append("g")
            .call(d3.axisLeft(yScale))
            .style("color", "#fff");

        // Add axis labels
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("fill", "#fff")
            .text("Basic Plan Price (USD)");

        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
            .style("text-anchor", "middle")
            .style("fill", "#fff")
            .text("Total Content Titles");

        // Create tooltip
        const tooltip = d3.select("#tooltip");

        // Function to categorize price tiers
        function getPriceCategory(price) {
            if (price < 5) return "Budget";
            if (price < 8) return "Emerging";
            if (price < 15) return "Mid-tier";
            return "Premium";
        }

        // Draw circles
        const circles = svg.selectAll(".dot")
            .data(data)
            .enter().append("circle")
            .attr("class", "dot")
            .attr("cx", d => xScale(d.totalTitles))
            .attr("cy", d => yScale(d.price))
            .attr("r", d => 6) // Default size
            .style("fill", d => colorScale(getPriceCategory(d.price)))
            .style("opacity", 0.8)
            .style("stroke", "rgba(255,255,255,0.3)")
            .style("stroke-width", 1)
            .on("mouseover", function(event, d) {
                d3.select(this).style("opacity", 1).style("stroke-width", 2);
                
                tooltip.transition()
                    .duration(200)
                    .style("opacity", 0.9);
                
                tooltip.html(`
                    <strong>${d.country}</strong><br>
                    Region: ${d.region}<br>
                    Total Titles: ${d.totalTitles.toLocaleString()}<br>
                    Price: $${d.price.toFixed(2)}<br>
                    Cost per Title: $${d.costPerTitle.toFixed(5)}<br>
                    Movies: ${d.movies.toLocaleString()}<br>
                    TV Shows: ${d.tvShows.toLocaleString()}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).style("opacity", 0.8).style("stroke-width", 1);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        // Add trend line
        const regression = d3.regressionLinear()
            .x(d => d.totalTitles)
            .y(d => d.price)
            .domain([d3.min(data, d => d.totalTitles), d3.max(data, d => d.totalTitles)]);
        
        const trendData = regression(data);
        
        svg.append("path")
            .datum(trendData)
            .attr("class", "trend-line")
            .attr("d", d3.line()
                .x(d => xScale(d[0]))
                .y(d => yScale(d[1])))
            .style("stroke", "#ff6b6b")
            .style("stroke-width", 2)
            .style("stroke-dasharray", "5,5")
            .style("opacity", 0.7)
            .style("fill", "none");

        // Add interactive controls
        document.getElementById("size-cost").addEventListener("click", function() {
            circles.transition()
                .duration(1000)
                .attr("r", d => sizeScale(d.costPerTitle));
        });
        
        document.getElementById("size-default").addEventListener("click", function() {
            circles.transition()
                .duration(1000)
                .attr("r", 6);
        });
        
        document.getElementById("highlight-premium").addEventListener("click", function() {
            circles.transition()
                .duration(500)
                .style("opacity", d => getPriceCategory(d.price) === "Premium" ? 1 : 0.2);
        });
        
        document.getElementById("highlight-value").addEventListener("click", function() {
            circles.transition()
                .duration(500)
                .style("opacity", d => d.costPerTitle < 0.0005 ? 1 : 0.2);
        });

        // Initial animation
        circles
            .attr("r", 0)
            .transition()
            .delay((d, i) => i * 20)
            .duration(1000)
            .attr("r", 6);
    </script>
</body>
</html>